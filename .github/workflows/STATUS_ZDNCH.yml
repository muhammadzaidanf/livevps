name: STATUS_ZDNCH

on:
  workflow_dispatch:

jobs:
  status-check:
    runs-on: windows-latest
    timeout-minutes: 5

    steps:
      - name: ZDNCH STATUS - Check FXServer Process
        shell: pwsh
        run: |
          Write-Host "== FXSERVER STATUS =="
          $fx = Get-Process FXServer -ErrorAction SilentlyContinue
          if ($fx) {
            Write-Host "FXServer : RUNNING (PID $($fx.Id))"
            echo "FXSERVER_STATUS=RUNNING" >> $env:GITHUB_ENV
          } else {
            Write-Host "FXServer : STOPPED"
            echo "FXSERVER_STATUS=STOPPED" >> $env:GITHUB_ENV
          }

      - name: ZDNCH STATUS - Check FiveM Ports
        shell: pwsh
        run: |
          Write-Host "== PORT STATUS (40120) =="
          $tcp = Test-NetConnection -ComputerName 127.0.0.1 -Port 40120 -InformationLevel Quiet
          $udp = Get-NetUDPEndpoint -LocalPort 40120 -ErrorAction SilentlyContinue

          if ($tcp) {
            Write-Host "TCP 40120 : OPEN"
          } else {
            Write-Host "TCP 40120 : CLOSED"
          }

          if ($udp) {
            Write-Host "UDP 40120 : OPEN"
          } else {
            Write-Host "UDP 40120 : CLOSED"
          }

      - name: ZDNCH STATUS - Summary
        shell: pwsh
        run: |
          Write-Host "========================="
          Write-Host "ZDNCH STATUS SUMMARY"
          Write-Host "FXServer : $env:FXSERVER_STATUS"
          Write-Host "========================="
